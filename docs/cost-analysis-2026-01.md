# コスト分析 - 2026年1月

## 📊 現在の使用量まとめ（2026年1月29日時点）

| サービス | プラン | 1月の使用量 | 無料枠 | 使用率 | 月額コスト | 警告 |
|---|---|---|---|---|---|---|
| **OpenAI API** | Pay-as-you-go | $0.00（0件） | 月上限$5 | 0% | $0.00 | なし |
| **Supabase** | Free Tier | DB: 25.25 MB<br>API: 0件 | DB: 500 MB<br>API: 50,000件/月 | DB: 5%<br>API: 0% | $0.00 | なし |
| **Render** | Free Tier | 0.1 CPU / 512MB | 750時間/月 | 正常稼働中 | $0.00 | なし |
| **Vercel** | Hobby (Free) | Transfer: 29.23 MB<br>Requests: 2,000 | Transfer: 100 GB<br>Requests: 1,000,000 | Transfer: 0%<br>Requests: 0.2% | $0.00 | なし |

**合計月額コスト**: **$0.00**（完全無料運用中）

---

## 🔍 重要な発見

### 1. **OpenAI API: $0.00（未使用）**
- **状態**: 1月の使用量が$0.00
- **理由**: 
  - ユーザーがまだ夢の分析機能を使っていない可能性
  - または、OPENAI_API_KEYが本番環境で設定されていない可能性
- **使用箇所**: 
  - `DreamAnalysisService`（夢の分析）
  - `AudioAnalysisService`（音声分析）
- **リスク**: 低（現在未使用）

### 2. **Supabase: 5%使用（非常に低い）**
- **データベースサイズ**: 25.25 MB / 500 MB（5%）
- **APIリクエスト**: 0件 / 50,000件/月（0%）
- **状態**: 非常に健全
- **リスク**: 低（無料枠の範囲内）

### 3. **Render: 正常稼働中**
- **インスタンス**: 0.1 CPU / 512MB
- **プラン**: Free Tier（750時間/月）
- **ヘルスチェック**: `/health`エンドポイント設定済み
- **状態**: 正常稼働中
- **リスク**: 低（無料枠の範囲内）

### 4. **Vercel: 0.2%使用（非常に低い）**
- **Fast Data Transfer**: 29.23 MB / 100 GB（0%）
- **Edge Requests**: 2,000 / 1,000,000（0.2%）
- **状態**: 非常に健全
- **リスク**: 低（無料枠の範囲内）

---

## 🚀 「もし1万人来たら？」シミュレーション

### 前提条件
- **現在のユーザー数**: 1人（開発者のみ）
- **想定ユーザー数**: 10,000人
- **想定使用パターン**: 
  - 1人あたり月10回の夢記録
  - 1人あたり月5回の夢分析（OpenAI API使用）
  - 1人あたり月20回のページ閲覧

---

### 1. **OpenAI API**

#### **現在の使用量**
- **1月の使用量**: $0.00（0件）

#### **10,000人来た場合の試算**
- **想定リクエスト数**: 10,000人 × 5回/月 = **50,000リクエスト/月**
- **想定コスト**: 
  - GPT-4o-mini使用（$0.15 / 1M input tokens, $0.60 / 1M output tokens）
  - 1リクエストあたり約500 input tokens + 200 output tokens
  - 50,000リクエスト × (500 × $0.15 / 1,000,000 + 200 × $0.60 / 1,000,000)
  - = 50,000 × ($0.000075 + $0.00012)
  - = 50,000 × $0.000195
  - = **$9.75/月**

#### **結論**
- **現在の月上限（$5）を超過** → **月上限を$10〜20に引き上げが必要**
- **または、キャッシュ戦略を導入**して、同じ夢の分析を再利用

---

### 2. **Supabase**

#### **現在の使用量**
- **データベースサイズ**: 25.25 MB / 500 MB（5%）
- **APIリクエスト**: 0件 / 50,000件/月（0%）

#### **10,000人来た場合の試算**
- **想定データベースサイズ**: 
  - 1人あたり10件の夢記録 × 平均5KB/件 = 50KB/人
  - 10,000人 × 50KB = **500MB**
  - **無料枠（500MB）をギリギリ超過**

- **想定APIリクエスト数**: 
  - 10,000人 × 30回/月（夢記録10回 + ページ閲覧20回） = **300,000リクエスト/月**
  - **無料枠（50,000件/月）を大幅に超過**

#### **結論**
- **無料枠を超過** → **有料プラン（Pro: $25/月）への移行が必要**
- **Pro プラン**: 
  - データベースサイズ: 8GB
  - APIリクエスト: 500,000件/月
  - 月額: $25

---

### 3. **Render**

#### **現在の使用量**
- **インスタンス**: 0.1 CPU / 512MB
- **プラン**: Free Tier（750時間/月）

#### **10,000人来た場合の試算**
- **想定CPU使用率**: 
  - 現在: 0.1 CPU（1人）
  - 10,000人: 0.1 CPU × 10,000 = **1,000 CPU**（非現実的）
  - **実際には、スケールアップが必要**

- **想定インスタンス**: 
  - **Starter プラン（$7/月）**: 0.5 CPU / 512MB
  - **Standard プラン（$25/月）**: 1 CPU / 2GB
  - **Pro プラン（$85/月）**: 2 CPU / 4GB

#### **結論**
- **無料枠では対応不可** → **有料プラン（Starter: $7/月 または Standard: $25/月）への移行が必要**
- **または、複数インスタンスでの負荷分散**

---

### 4. **Vercel**

#### **現在の使用量**
- **Fast Data Transfer**: 29.23 MB / 100 GB（0%）
- **Edge Requests**: 2,000 / 1,000,000（0.2%）

#### **10,000人来た場合の試算**
- **想定データ転送量**: 
  - 1人あたり月20回のページ閲覧 × 平均500KB/ページ = 10MB/人
  - 10,000人 × 10MB = **100GB**
  - **無料枠（100GB）をギリギリ超過**

- **想定リクエスト数**: 
  - 10,000人 × 20回/月 = **200,000リクエスト/月**
  - **無料枠（1,000,000件/月）の範囲内**

#### **結論**
- **データ転送量が無料枠をギリギリ超過** → **有料プラン（Pro: $20/月）への移行が必要**
- **Pro プラン**: 
  - データ転送量: 1TB
  - リクエスト数: 無制限
  - 月額: $20

---

## 💰 「もし1万人来たら？」コスト試算まとめ

| サービス | 現在のコスト | 10,000人来た場合のコスト | 差額 | 備考 |
|---|---|---|---|---|
| **OpenAI API** | $0.00 | $9.75/月 | +$9.75 | 月上限を$10〜20に引き上げ、またはキャッシュ戦略導入 |
| **Supabase** | $0.00 | $25/月（Pro） | +$25 | データベースサイズとAPIリクエスト数が無料枠を超過 |
| **Render** | $0.00 | $25/月（Standard） | +$25 | CPU使用率が無料枠を超過、スケールアップが必要 |
| **Vercel** | $0.00 | $20/月（Pro） | +$20 | データ転送量が無料枠をギリギリ超過 |
| **合計** | **$0.00** | **$79.75/月** | **+$79.75** | - |

---

## 🔥 どこが先に死ぬか？

### **1位: Supabase（APIリクエスト数）**
- **無料枠**: 50,000件/月
- **10,000人来た場合**: 300,000リクエスト/月
- **超過率**: **600%**
- **結論**: **最も早く無料枠を超過する**

### **2位: Render（CPU使用率）**
- **無料枠**: 0.1 CPU / 512MB
- **10,000人来た場合**: スケールアップが必要
- **結論**: **2番目に早く無料枠を超過する**

### **3位: Vercel（データ転送量）**
- **無料枠**: 100GB
- **10,000人来た場合**: 100GB（ギリギリ）
- **結論**: **3番目に早く無料枠を超過する**

### **4位: OpenAI API（月上限）**
- **月上限**: $5
- **10,000人来た場合**: $9.75/月
- **結論**: **4番目に早く月上限を超過する**

---

## 📝 コスト最適化の戦略

### **短期的な対策（1〜3ヶ月）**

1. **OpenAI API: キャッシュ戦略を導入**
   - 同じ夢の分析結果をキャッシュして再利用
   - Redis または Supabase のキャッシュテーブルを使用
   - **コスト削減効果**: 50〜80%

2. **Supabase: APIリクエスト数を削減**
   - フロントエンドでのキャッシュを強化
   - ページネーションを導入して、一度に取得するデータ量を削減
   - **コスト削減効果**: 30〜50%

3. **Render: 無料枠の範囲内で運用**
   - 現在のインスタンス（0.1 CPU / 512MB）で運用を継続
   - ユーザー数が100人を超えたら、有料プランへの移行を検討

4. **Vercel: 無料枠の範囲内で運用**
   - 画像の最適化（Next.js の Image コンポーネントを使用）
   - 静的ファイルの圧縮（gzip, brotli）
   - **コスト削減効果**: 20〜30%

---

### **中期的な対策（3〜6ヶ月）**

1. **Supabase: 有料プラン（Pro: $25/月）への移行**
   - データベースサイズ: 8GB
   - APIリクエスト: 500,000件/月
   - ユーザー数が1,000人を超えたら移行

2. **Render: 有料プラン（Starter: $7/月）への移行**
   - 0.5 CPU / 512MB
   - ユーザー数が100人を超えたら移行

3. **OpenAI API: 月上限を$10〜20に引き上げ**
   - ユーザー数が500人を超えたら引き上げ

---

### **長期的な対策（6ヶ月〜1年）**

1. **Vercel: 有料プラン（Pro: $20/月）への移行**
   - データ転送量: 1TB
   - ユーザー数が5,000人を超えたら移行

2. **Render: 有料プラン（Standard: $25/月）への移行**
   - 1 CPU / 2GB
   - ユーザー数が1,000人を超えたら移行

3. **Supabase: 有料プラン（Team: $599/月）への移行**
   - データベースサイズ: 100GB
   - APIリクエスト: 5,000,000件/月
   - ユーザー数が10,000人を超えたら移行

---

## 🎯 次のステップ

### **2月Week 1（2026/1/29 - 2/4）**
1. ✅ **コスト棚卸し完了**
2. ⬜ **キャッシュ戦略の設計**（OpenAI API、Supabase）
3. ⬜ **画像最適化の実装**（Vercel）

### **2月Week 2（2026/2/5 - 2/11）**
1. ⬜ **キャッシュ戦略の実装**（OpenAI API、Supabase）
2. ⬜ **ページネーションの実装**（Supabase）

### **2月Week 3（2026/2/12 - 2/18）**
1. ⬜ **コスト監視ダッシュボードの作成**
2. ⬜ **アラート設定**（無料枠の80%を超えたら通知）

### **2月Week 4（2026/2/19 - 2/25）**
1. ⬜ **コスト最適化の効果測定**
2. ⬜ **次月のコスト予測**

---

**作成日**: 2026年1月29日 05:17  
**作成者**: isekaisaru  
**目的**: DreamJournalアプリのコスト分析と最適化戦略の策定
